models:
  Company:
    tp_name: string
    tp_type: string
    tp_TIN: string
    tp_trade_number: string nullable
    tp_postal_number: string nullable
    tp_phone_number: string nullable
    tp_address_province: string nullable
    tp_address_commune: string nullable
    tp_address_quartier: string nullable
    tp_address_avenue: string nullable
    tp_address_rue: string nullable
    tp_address_number: string nullable
    vat_taxpayer: string nullable
    ct_taxpayer: string nullable
    tl_taxpayer: string nullable
    tp_fiscal_center: string nullable
    tp_activity_sector: string nullable
    tp_legal_form: string nullable
    payment_type: string nullable
    is_actif: boolean default:true
    user_id: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: User
      hasMany: Agency, Stock, Category, Product, Client, Supplier, Purchase, Sale, CashRegister, Expense, ExpenseType

  Agency:
    company_id: id foreign:companies
    code: string unique
    name: string
    adresse: string
    manager_id: id foreign:users nullable
    parent_agency_id: id foreign:agencies nullable
    is_main_office: boolean default:false
    created_by: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: Company, User, Agency, User
      hasMany: Agency, Stock, Category, Product, Client, Supplier, Purchase, Sale, CashRegister, Expense, ExpenseType, UserStock, StockTransfer, CashTransaction

  Stock:
    name: string
    location: string nullable
    description: text nullable
    agency_id: id foreign:agencies nullable
    created_by: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: Agency, User
      hasMany: UserStock, StockProduct, Purchase, Sale, StockTransfer, CashRegister, Expense
      belongsToMany: User, Product

  UserStock:
    user_id: id foreign:users
    stock_id: id foreign:stocks
    agency_id: id foreign:agencies nullable
    created_by: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: User, Stock, Agency, User

  Category:
    name: string
    description: text nullable
    agency_id: id foreign:agencies nullable
    created_by: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: Agency, User
      hasMany: Product

  Product:
    name: string
    description: text nullable
    category_id: id foreign:categories
    purchase_price: decimal
    sale_price: decimal
    unit: string
    alert_quantity: float
    agency_id: id foreign:agencies nullable
    created_by: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: Category, Agency, User
      hasMany: StockProduct, PurchaseItem, SaleItem, StockTransferItem
      belongsToMany: Stock

  StockProduct:
    stock_id: id foreign:stocks
    product_id: id foreign:products
    quantity: float
    agency_id: id foreign:agencies nullable
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: Stock, Product, Agency

  Client:
    name: string
    phone: string nullable
    email: string nullable
    address: text nullable
    balance: decimal default:0
    nif: text nullable
    agency_id: id foreign:agencies nullable
    created_by: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: Agency, User
      hasMany: Sale

  Supplier:
    name: string
    phone: string nullable
    email: string nullable
    address: text nullable
    agency_id: id foreign:agencies nullable
    created_by: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: Agency, User
      hasMany: Purchase

  Purchase:
    supplier_id: id foreign:suppliers
    stock_id: id foreign:stocks
    total_amount: decimal
    paid_amount: decimal
    due_amount: decimal
    purchase_date: datetime
    agency_id: id foreign:agencies nullable
    created_by: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: Supplier, Stock, Agency, User
      hasMany: PurchaseItem, Payment

  PurchaseItem:
    purchase_id: id foreign:purchases
    product_id: id foreign:products
    quantity: integer
    purchase_price: decimal
    subtotal: decimal
    agency_id: id foreign:agencies nullable
    created_by: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: Purchase, Product, Agency, User

  Sale:
    client_id: id foreign:clients
    stock_id: id foreign:stocks
    user_id: id foreign:users
    total_amount: decimal
    paid_amount: decimal
    due_amount: decimal
    sale_date: datetime
    agency_id: id foreign:agencies nullable
    created_by: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: Client, Stock, User, Agency, User
      hasMany: SaleItem, Payment

  SaleItem:
    sale_id: id foreign:sales
    product_id: id foreign:products
    quantity: integer
    sale_price: decimal
    discount: decimal
    subtotal: decimal
    agency_id: id foreign:agencies nullable
    created_by: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: Sale, Product, Agency, User

  Payment:
    payment_type: string
    reference_id: integer
    amount: decimal
    payment_method: string
    payment_date: datetime
    agency_id: id foreign:agencies nullable
    created_by: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: Agency, User

  StockTransfer:
    from_stock_id: id foreign:stocks
    to_stock_id: id foreign:stocks
    user_id: id foreign:users
    transfer_date: datetime
    note: text
    agency_id: id foreign:agencies nullable
    created_by: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: Stock, Stock, User, Agency, User
      hasMany: StockTransferItem

  StockTransferItem:
    stock_transfer_id: id foreign:stock_transfers
    product_id: id foreign:products
    quantity: integer
    agency_id: id foreign:agencies nullable
    created_by: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: StockTransfer, Product, Agency, User

  CashRegister:
    user_id: id foreign:users
    stock_id: id foreign:stocks
    opening_balance: decimal
    closing_balance: decimal
    status: string
    opened_at: datetime
    closed_at: datetime
    agency_id: id foreign:agencies nullable
    created_by: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: User, Stock, Agency, User
      hasMany: CashTransaction

  CashTransaction:
    cash_register_id: id foreign:cash_registers
    type: string
    reference_id: integer
    amount: decimal
    description: text
    agency_id: id foreign:agencies nullable
    created_by: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: CashRegister, Agency, User

  Expense:
    stock_id: id foreign:stocks
    user_id: id foreign:users
    expense_type_id: id foreign:expense_types
    amount: decimal
    description: text
    expense_date: datetime
    agency_id: id foreign:agencies nullable
    created_by: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: Stock, User, ExpenseType, Agency, User
      hasMany: Payment, CashTransaction

  ExpenseType:
    name: string unique
    description: text
    agency_id: id foreign:agencies nullable
    created_by: id foreign:users
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: Agency, User
      hasMany: Expense

  User:
    first_name: string
    last_name: string
    email: string unique
    email_verified_at: timestamp nullable
    password: string
    phone: string nullable
    address: text nullable
    date_of_birth: date nullable
    gender: enum[male,female,other] nullable
    profile_photo: string nullable
    status: enum[active,inactive,suspended] default:active
    role: enum[super_admin,company_admin,agency_manager,cashier,salesperson,accountant,stock_manager] default:salesperson
    permissions: json nullable
    last_login_at: timestamp nullable
    must_change_password: boolean default:false
    two_factor_enabled: boolean default:false
    two_factor_secret: string nullable
    recovery_codes: json nullable
    company_id: id foreign:companies nullable
    agency_id: id foreign:agencies nullable
    created_by: id foreign:users nullable
    remember_token: string nullable
    timestamps: true
    softDeletes: true
    relationships:
      belongsTo: Company, Agency, User
      hasMany: Company, Agency, Stock, UserStock, Category, Product, Client, Supplier, Purchase, Sale, CashRegister, CashTransaction, Expense, ExpenseType, StockTransfer, Payment, User
      belongsToMany: Stock

controllers:
  Company:
    resource: web
  Agency:
    resource: web
  User:
    resource: web
  Stock:
    resource: web
  Category:
    resource: web
  Product:
    resource: web
  Client:
    resource: web
  Supplier:
    resource: web
  Purchase:
    resource: web
  Sale:
    resource: web
  CashRegister:
    resource: web
  CashTransaction:
    resource: web
  Expense:
    resource: web
  ExpenseType:
    resource: web
  StockTransfer:
    resource: web
  Payment:
    resource: web
  UserStock:
    resource: web


seeders:
  - User
  - Company
  - Stock
  - Category
  - Product
  - Client
  - Supplier
  - Purchase
  - PurchaseItem
  - Sale
  - SaleItem
  - Payment
  - StockTransfer
  - StockTransferItem
  - CashRegister
  - CashTransaction
  - Expense
  - ExpenseType
